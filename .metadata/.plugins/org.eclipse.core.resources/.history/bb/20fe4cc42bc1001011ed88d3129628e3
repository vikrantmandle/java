package com.app.basic.streams.revision;

import java.util.AbstractMap;
import java.util.Comparator;
import java.util.List;
import java.util.Map;
import java.util.Optional;
import java.util.stream.Collectors;

import com.app.basic.streams.data.Department;
import com.app.java.streams.prep.Employee;

public class Day6 {
	
	//Problem 1 — Flatten and Group Nested Data
	static void problem1() {
		List<Department>departmentData=Department.populateDepartments();
		
		Map<String, Long> totalSalaryPerDept=departmentData.stream().flatMap(n->n.getEmployees().
				stream()
				.map(emp->new AbstractMap.SimpleEntry<>(n.getName(),emp.getSalary())))
				.collect(Collectors.groupingBy(Map.Entry::getKey, Collectors.summingLong(Map.Entry::getValue)));
	
		totalSalaryPerDept.forEach((dept, total) ->System.out.println(dept + " → " + total));
	}

	//Problem 2 — Find Top N Employees by Salary per Department
	static void problem2(int n) {
	List<Employee>employee=Employee.populateEmployee();
	Map<String,Optional<Employee>> specificHighest=	employee.stream().collect(Collectors.groupingBy(Employee::getDepartment,
				Collectors.collectingAndThen(Collectors.toList(), list->list.stream().sorted(Comparator.comparingLong(Employee::getSalary).reversed()).skip(n).findFirst())));
	specificHighest.forEach((dep,data)->System.out.println("Department= "+dep+"  "+data.orElse(null)));
	}
	
	//Problem 2.2 — Find Top N Employees by Salary per Department
	static void problem2_2(){

		List<Department> departments = Department.populateDepartments();
		System.out.println("Departments=> "+departments);
	
		Map<String,Object> nth_salary_of_department=departments.stream().collect(Collectors.toMap(Department::getName, dept->dept.getEmployees().stream()
				.sorted(Comparator.comparingLong(Employee::getSalary).reversed()).skip(1).findFirst()));
	
		nth_salary_of_department.forEach((dept, list) -> {
		    System.out.println(dept + " → " + list);});
	}
	
	
	//Problem 3 — Convert List to Custom String Format
	static void problem3() {
		List<String> names = List.of("John", "Ben", "Adam", "Clark");
		String customNameFormat=names.stream().
				collect(Collectors.joining(" | ", "Employee Names: ", ""));
		System.out.println("customNameFormat=> "+customNameFormat);
	}
	
	//Problem 4 — Partition Employees by Salary Range
	static void problem4() {
		List<Employee> employee =Department.populateDepartments().stream()
				.flatMap(dept->dept.getEmployees().stream())
				.collect(Collectors.toList());
		Map<Boolean,List<Employee>>partioendEmployee= employee.stream().collect(Collectors.partitioningBy(n->n.getSalary()>100000));
	
	partioendEmployee.forEach((isHigh,emp)->System.out.println((isHigh ? "High Earners (>100k)" : "Others") + " → " + emp));
	}
	
	public static void main(String[] args) {
		problem1();
		System.out.println("------------------");
		problem2(2);
		System.out.println("------------------");
		problem2_2();
		System.out.println("------------------");
		problem3();
		System.out.println("-------------------");
		problem4();
	}

}
